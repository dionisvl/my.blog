{% extends 'base.html.twig' %}

{% block content %}
    <div class="w-full md:w-3/4 pr-0 md:pr-6">
        <article class="bg-gray-800 rounded-lg shadow-sm overflow-hidden border border-gray-700">
            {% if post.image %}
                <div class="w-full h-64 md:h-96 flex items-center justify-center bg-gray-700">
                    <img src="{{ post.image }}" alt="{{ post.title }}"
                         height="384"
                         class="w-full h-full object-contain">
                </div>
            {% endif %}

            <div class="p-6">
                <header class="text-center mb-6">
                    {% if post.category %}
                        <h6 class="text-sm mb-2">
                            <a href="#" class="text-blue-500 hover:text-blue-700">{{ post.category.title }}</a>
                        </h6>
                    {% endif %}
                    <h1 class="text-3xl font-bold text-white mb-2">{{ post.title }}</h1>
                </header>

                <div class="prose max-w-none">
                    {{ post.content|raw }}
                </div>

                {% if post.tags|length > 0 %}
                    <div class="flex flex-wrap mt-6 mb-4">
                        {% for tag in post.tags %}
                            <a href="#"
                               class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-full text-sm mr-2 mb-2 transition text-white">
                                {{ tag.title }}
                            </a>
                        {% endfor %}
                    </div>
                {% endif %}

                <div class="flex justify-between items-center text-sm text-gray-400 pt-4 border-t border-gray-700">
                    <span>
                        {% if post.author %}
                            By <a href="#" class="hover:text-blue-400">{{ post.author.name }}</a>
                        {% endif %}
                        On <b>{{ post.formattedDate }}</b>
                    </span>

                    <div class="flex items-center">
                        <span class="flex items-center mr-4">
                            <i class="fas fa-eye mr-1"></i> {{ post.viewsCount }}
                        </span>
                        <a class="flex items-center w-full sm:w-auto group"
                           onclick="Likes.toggle(this,event);"
                           data-post_id="{{ post.id }}"
                           href="#"
                           title="Like">
                            <i class="far fa-heart text-red-500 mr-1 heart-icon transition-transform duration-500"></i>
                            <span class="like_button_count transition-colors duration-500 group-hover:text-blue-400">
                                {{ post.likesCount }}
                            </span>
                        </a>

                        <div class="ml-4">
                            <script src="//yastatic.net/share2/share.js"></script>
                            <div class="ya-share2" data-services="facebook,twitter,linkedin,telegram"></div>
                        </div>
                    </div>
                </div>
            </div>
        </article>

        <!-- Comments Section -->
        <div class="mt-8">
            {% for comment in post.comments %}
                <div class="bg-gray-800 p-4 mb-4 rounded-lg border border-gray-700 flex">
                    <div class="mr-4 flex-shrink-0">
                        <img class="rounded-full w-12 h-12 object-cover" src="{{ comment.authorImage }}"
                             alt="{{ comment.authorName }}">
                    </div>
                    <div>
                        <h5 class="font-semibold text-white">{{ comment.authorName }}</h5>
                        <p class="text-xs text-gray-400 mb-2">{{ comment.diffForHumans }}</p>
                        <p class="text-gray-300">{{ comment.text }}</p>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Comment Form -->
        <div class="bg-gray-800 p-6 mt-8 rounded-lg border border-gray-700">
            <h4 class="text-xl font-semibold mb-4 text-white">Leave a reply</h4>

            {% for message in app.flashes('error') %}
                <div class="bg-red-500 text-white p-3 rounded mb-4">{{ message }}</div>
            {% endfor %}

            {% for message in app.flashes('success') %}
                <div class="bg-green-500 text-white p-3 rounded mb-4">{{ message }}</div>
            {% endfor %}

            <form class="w-full" role="form" method="post" action="{{ path('comment_store') }}">
                <input type="hidden" name="_token" value="{{ csrf_token('comment') }}">
                <input type="hidden" name="post_id" value="{{ post.id }}">
                <div class="mb-4">
                    {# Honeypot field - should remain empty #}
                    <input type="text" name="honeypot" value="" style="display:none;">

                    {# Anti-bot counter #}
                    <input type="hidden" class="countMe" name="countMe" value="0">

                    <textarea required
                              class="w-full border border-gray-600 bg-gray-700 text-white rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-gray-400"
                              rows="4" name="message" placeholder="Write some comment"
                              onkeyup="count_keyup()"></textarea>
                </div>
                <button
                    class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-6 rounded-md transition duration-200 font-medium">
                    Post Comment
                </button>
            </form>
        </div>
    </div>

    {% include 'home/_sidebar.html.twig' %}
{% endblock %}
